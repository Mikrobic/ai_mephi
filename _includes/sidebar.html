<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>{{ site.description }}</p>
  </div>

  <nav class="sidebar-nav">
    <!-- Главная ссылка -->
    <a class="sidebar-nav-item{% if page.url == '/' %} active{% endif %}" href="{{ '/' | absolute_url }}">Home</a>
    
    <!-- Вложенное меню Home -->
    <div class="sidebar-nav-group{% if page.url contains '/Home/' %} active{% endif %}">
      <a href="javascript:void(0)" class="sidebar-nav-item sidebar-nav-toggle{% if page.url contains '/Home/' %} active{% endif %}">
        Home Section
        <svg class="toggle-icon" viewBox="0 0 24 24">
          <path d="M7 10l5 5 5-5z"/>
        </svg>
      </a>
      <div class="sidebar-submenu">
        <a href="/Home/" class="sidebar-nav-item submenu-item{% if page.url == '/Home/' %} active{% endif %}">* Main Home</a>
        <a href="/Home/subpage/" class="sidebar-nav-item submenu-item{% if page.url == '/Home/subpage/' %} active{% endif %}">* Subpage</a>
      </div>
    </div>

    {% comment %}
      The code below dynamically generates a sidebar nav of pages with
      `layout: page` in the front-matter. See readme for usage.
    {% endcomment %}

    {% assign pages_list = site.pages | sort:"url" %}
    {% for node in pages_list %}
      {% if node.title != null %}
        {% if node.layout == "page" %}
          {% unless node.url == '/' or node.url contains '/Home/' %}
            <a class="sidebar-nav-item{% if page.url == node.url %} active{% endif %}" href="{{ node.url | absolute_url }}">{{ node.title }}</a>
          {% endunless %}
        {% endif %}
      {% endif %}
    {% endfor %}

    <!-- Оригинальные ссылки -->
    <a class="sidebar-nav-item" href="{{ site.github.repo }}/archive/v{{ site.version }}.zip">Download</a>
    <a class="sidebar-nav-item" href="{{ site.github.repo }}">GitHub project</a>
    <span class="sidebar-nav-item">Currently v{{ site.version }}</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; {{ site.time | date: '%Y' }}. All rights reserved.
    </p>
  </div>
</div>

<style>
  /* Стили для групп меню */
  .sidebar-nav-group {
    position: relative;
  }

  .sidebar-nav-toggle {
    position: relative;
    padding-right: 2rem;
  }

  .toggle-icon {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 1em;
    height: 1em;
    fill: currentColor;
    transition: transform 0.2s;
  }

  .sidebar-nav-group.active .toggle-icon {
    transform: translateY(-50%) rotate(180deg);
  }

  .sidebar-submenu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    margin-left: 15px; /* Сдвиг вправо */
  }

  .sidebar-nav-group.active .sidebar-submenu {
    max-height: 500px;
  }

  /* Стили для подпунктов */
  .submenu-item {
    position: relative;
    padding-left: 15px !important;
  }

  .submenu-item::before {
    content: "*";
    position: absolute;
    left: 0;
    color: #268bd2;
  }

  .sidebar-nav-toggle, 
  .sidebar-nav-toggle:hover {
    color: inherit;
    text-decoration: none;
  }
</style>

<script>
(function(document) {
  // Оригинальный код для закрытия сайдбара
  var toggle = document.querySelector('.sidebar-toggle');
  var sidebar = document.querySelector('#sidebar');
  var checkbox = document.querySelector('#sidebar-checkbox');

  document.addEventListener('click', function(e) {
    var target = e.target;
    if (!checkbox.checked || sidebar.contains(target) || target === checkbox) return;
    checkbox.checked = false;
  });

  // Обработчики для раскрывающихся меню
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.sidebar-nav-toggle');
    
    toggleButtons.forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const group = this.closest('.sidebar-nav-group');
        group.classList.toggle('active');
      });
    });

    // Автоматически раскрываем активную группу
    const activeSubItem = document.querySelector('.sidebar-submenu .active');
    if (activeSubItem) {
      activeSubItem.closest('.sidebar-nav-group').classList.add('active');
    }
  });
})(document);
</script>
